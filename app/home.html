<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home Aurora</title>
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1a1a2e',
            accent: '#0f3460',
            aurora: '#e94560',
            cyan: '#00d4ff',
            light: '#f8fafc',
          }
        }
      }
    }
  </script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460, #e94560, #00d4ff);
      background-size: 400% 400%;
      animation: aurora 30s ease infinite;
      color: white;
    }
    @keyframes aurora {
      0%,100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .section-card {
      background: white;
      color: #1a1a2e;
      border-radius: 1.5rem;
      box-shadow: 0 16px 32px rgba(0, 0, 0, 0.2);
      padding: 2rem;
      margin-bottom: 2rem;
      border: 2px solid #e5e7eb;
    }
    .card-item {
      background: #f8fafc;
      border: 2px solid #d1d5db;
      border-radius: 1rem;
      padding: 1rem;
      transition: transform 0.2s;
    }
    .card-item:hover {
      transform: scale(1.02);
    }
    .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 700;
      color: white;
      background: linear-gradient(to right, #00d4ff, #0f3460);
    }
    .btn-primary {
      background: linear-gradient(to right, #e94560, #00d4ff);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 0.75rem;
      font-weight: bold;
      text-decoration: none;
      display: inline-block;
      margin-top: 1rem;
    }
  </style>
</head>
<body>

<header class="sticky top-0 z-50 backdrop-blur bg-white/80 border-b border-aurora px-6 py-4 flex justify-between items-center">
  <h1 class="text-xl font-black text-primary">MyApp</h1>
  <button id="logoutBtn" class="btn-primary text-sm">Logout</button>
</header>

<main class="max-w-6xl mx-auto px-6 py-10">

  <!-- Benvenuto -->
  <section class="section-card text-center">
    <h2 id="salutoPersonalizzato" class="text-2xl font-bold mb-2">Benvenuto!</h2>
    <p id="dataOdierna" class="text-gray-600">Caricamento...</p>
  </section>

  <!-- Accesso rapido -->
  <section class="section-card">
    <h3 class="text-xl font-bold mb-6">üöÄ Accesso Rapido</h3>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div onclick="navigateTo('tessera.html')" class="card-item text-center cursor-pointer">üÜî<div class="font-semibold">Tessera</div></div>
      <div onclick="navigateTo('strumenti.html')" class="card-item text-center cursor-pointer">üõ†Ô∏è<div class="font-semibold">Strumenti</div></div>
      <div onclick="navigateTo('virgilio.html')" class="card-item text-center cursor-pointer">ü§ñ<div class="font-semibold">Virgilio AI</div></div>
      <div onclick="navigateTo('profilo.html')" class="card-item text-center cursor-pointer">üë§<div class="font-semibold">Profilo</div></div>
    </div>
  </section>

  <!-- Notizie -->
  <section class="section-card">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-bold">üì∞ Ultime Notizie</h3>
      <a href="notifiche.html" class="btn-primary text-sm">Vedi tutte</a>
    </div>
    <div id="notizieContainer" class="space-y-4">
      <p>Caricamento notizie...</p>
    </div>
  </section>

  <!-- Convenzioni -->
  <section class="section-card">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-bold">üè∑Ô∏è Convenzioni Attive</h3>
      <a href="convenzioni.html" class="btn-primary text-sm">Scopri tutte</a>
    </div>
    <div id="convenzioniContainer" class="space-y-4">
      <p>Caricamento convenzioni...</p>
    </div>
  </section>

  <!-- Tutela -->
  <section class="section-card">
    <h3 class="text-xl font-bold mb-6">üõ°Ô∏è Servizi di Tutela BestBadge</h3>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div onclick="navigateTo('servizi.html')" class="card-item text-center cursor-pointer">‚öñÔ∏è<div class="font-semibold">Penale <span class="badge">Specializzato</span></div></div>
      <div onclick="navigateTo('servizi.html')" class="card-item text-center cursor-pointer">üìã<div class="font-semibold">Civile <span class="badge">Completo</span></div></div>
      <div onclick="navigateTo('servizi.html')" class="card-item text-center cursor-pointer">üèõÔ∏è<div class="font-semibold">Amministrativo <span class="badge">Militare</span></div></div>
      <div onclick="navigateTo('servizi.html')" class="card-item text-center cursor-pointer">üìä<div class="font-semibold">Fiscale <span class="badge">CAF</span></div></div>
    </div>
  </section>

</main>

<!-- CTA -->
<a href="dirigenti.html" class="fixed bottom-6 right-6 bg-gradient-to-r from-aurora to-cyan text-white px-5 py-3 rounded-full shadow-lg font-semibold">
  üë• Contatta un dirigente della tua zona
</a>

<!-- Supabase Script -->
<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
  const supabase = createClient(
    'https://lycrgzptkdkksukcwrld.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx5Y3JnenB0a2Rra3N1a2N3cmxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3ODQyMzAsImV4cCI6MjA2ODM2MDIzMH0.ZJGOXAMC3hKKrnwXHKEa2_Eh7ZpOKeLYvYlYneBiEfk'
  );

  async function init() {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) return location.href = '../login.html';

    const { data: profile } = await supabase.from('profiles').select('nome').eq('id', user.id).single();
    const nome = profile?.nome || 'Utente';

    const ora = new Date().getHours();
    const saluto = ora < 12 ? "Buongiorno" : ora < 18 ? "Buon pomeriggio" : "Buonasera";
    document.getElementById("salutoPersonalizzato").textContent = `${saluto}, ${nome}!`;
    document.getElementById("dataOdierna").textContent = new Date().toLocaleDateString('it-IT', {
      weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
    });

    loadNotizie();
    loadConvenzioni();
  }

  async function loadNotizie() {
    const { data } = await supabase
      .from('notizie')
      .select('titolo, contenuto, data_pubblicazione, priorita')
      .eq('pubblicata', true)
      .order('data_pubblicazione', { ascending: false })
      .limit(3);

    const container = document.getElementById("notizieContainer");
    if (!data || !data.length) {
      container.innerHTML = '<p>Nessuna notizia disponibile</p>';
      return;
    }
    container.innerHTML = data.map(n => `
      <div class="card-item">
        <div class="font-bold">${n.titolo}</div>
        <p class="text-sm text-gray-700 mb-2">${n.contenuto.slice(0, 100)}...</p>
        <span class="text-xs text-aurora font-bold">${new Date(n.data_pubblicazione).toLocaleDateString('it-IT')}</span>
      </div>
    `).join('');
  }

  async function loadConvenzioni() {
    const { data } = await supabase
      .from('convenzioni')
      .select('nome_partner, descrizione, categoria, sconto_percentuale')
      .eq('attiva', true)
      .limit(4);

    const container = document.getElementById("convenzioniContainer");
    if (!data || !data.length) {
      container.innerHTML = '<p>Nessuna convenzione attiva</p>';
      return;
    }
    container.innerHTML = data.map(c => `
      <div class="card-item">
        <div class="font-bold">${c.nome_partner}</div>
        <p class="text-sm text-gray-700">${c.descrizione?.slice(0, 100) || ''}</p>
        <div class="mt-2 flex gap-2">
          <span class="badge">${c.categoria}</span>
          ${c.sconto_percentuale ? `<span class="badge">-${c.sconto_percentuale}%</span>` : ''}
        </div>
      </div>
    `).join('');
  }

  window.navigateTo = (url) => window.location.href = url;

  document.getElementById("logoutBtn").addEventListener("click", async () => {
    if (confirm("Vuoi davvero uscire?")) {
      await supabase.auth.signOut();
      location.href = '../login.html';
    }
  });

  init();
</script>

</body>
</html>
