<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home Dirigenti Aurora</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'inter': ['Inter', 'sans-serif'],
          },
          colors: {
            primary: '#1a1a2e',
            secondary: '#16213e',
            accent: '#0f3460',
            aurora: '#e94560',
            cyan: '#00d4ff',
            magenta: '#ff006e',
            gold: '#ffd700',
            teal: '#03dac6',
            dark: '#0a0a23',
            light: '#f8fafc',
            success: '#10b981'
          }
        }
      }
    }
  </script>
  
  <style>
    * {
      font-family: 'Inter', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460, #e94560, #00d4ff);
      background-size: 400% 400%;
      animation: aurora 30s ease infinite;
      color: white;
    }

    @keyframes aurora {
      0%,100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .section-card {
      background: white;
      color: #1a1a2e;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
      padding: 2rem;
      margin-bottom: 2rem;
      border: 2px solid rgba(255, 215, 0, 0.12);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .section-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15);
      border-color: rgba(255, 215, 0, 0.25);
    }

    .card-item {
      background: linear-gradient(145deg, #ffffff, #f8fafc);
      border: 2px solid #e5e7eb;
      border-radius: 16px;
      padding: 1.25rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .card-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #ffd700, #e94560, #00d4ff);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .card-item:hover::before {
      transform: scaleX(1);
    }

    .card-item:hover {
      transform: translateY(-4px) scale(1.02);
      border-color: rgba(255, 215, 0, 0.4);
      box-shadow: 0 15px 35px rgba(255, 215, 0, 0.2);
      background: linear-gradient(145deg, #ffffff, #fefefe);
    }

    .card-item:active {
      transform: translateY(-2px) scale(0.98);
    }

    .news-item {
      background: linear-gradient(145deg, #ffffff, #f8fafc);
      border: 2px solid rgba(233, 69, 96, 0.1);
      border-radius: 16px;
      padding: 1.25rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-left: 5px solid #e94560;
      position: relative;
      overflow: hidden;
    }

    .news-item::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(180deg, #e94560, #ff006e);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .news-item:hover::after {
      opacity: 1;
    }

    .news-item:hover {
      background: linear-gradient(145deg, #ffffff, #fef2f2);
      transform: translateX(6px);
      border-color: rgba(233, 69, 96, 0.2);
      box-shadow: 0 10px 25px rgba(233, 69, 96, 0.1);
    }

    .convenzione-item {
      background: linear-gradient(145deg, #ffffff, #f8fafc);
      border: 2px solid rgba(0, 212, 255, 0.1);
      border-radius: 16px;
      padding: 1.25rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-left: 5px solid #00d4ff;
      position: relative;
      overflow: hidden;
    }

    .convenzione-item::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(180deg, #00d4ff, #03dac6);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .convenzione-item:hover::after {
      opacity: 1;
    }

    .convenzione-item:hover {
      background: linear-gradient(145deg, #ffffff, #f0f9ff);
      transform: translateX(6px);
      border-color: rgba(0, 212, 255, 0.2);
      box-shadow: 0 10px 25px rgba(0, 212, 255, 0.1);
    }

    .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 700;
      color: white;
      background: linear-gradient(to right, #00d4ff, #0f3460);
      margin-top: 0.5rem;
    }

    .badge.success {
      background: linear-gradient(to right, #10b981, #059669);
    }

    .badge.aurora {
      background: linear-gradient(to right, #e94560, #ff006e);
    }

    .badge.gold {
      background: linear-gradient(to right, #ffd700, #ffb347);
      color: #1a1a2e;
    }

    .btn-primary {
      background: linear-gradient(to right, #e94560, #00d4ff);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 0.75rem;
      font-weight: bold;
      text-decoration: none;
      display: inline-block;
      margin-top: 1rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(233, 69, 96, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(233, 69, 96, 0.4);
    }

    .btn-secondary {
      background: white;
      color: #1a1a2e;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-weight: 600;
      text-decoration: none;
      display: inline-block;
      border: 2px solid #e5e7eb;
      transition: all 0.2s ease;
      font-size: 0.875rem;
    }

    .btn-secondary:hover {
      border-color: #00d4ff;
      background: #f0f9ff;
    }

    .btn-gold {
      background: linear-gradient(to right, #ffd700, #ffb347);
      color: #1a1a2e;
      padding: 0.75rem 1.5rem;
      border-radius: 0.75rem;
      font-weight: bold;
      text-decoration: none;
      display: inline-block;
      margin-top: 0.5rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
      border: 2px solid rgba(255, 215, 0, 0.2);
    }

    .btn-gold:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
      border-color: rgba(255, 215, 0, 0.5);
    }

    .header-glass {
      backdrop-filter: blur(12px);
      background: rgba(255, 255, 255, 0.9);
      border-bottom: 1px solid rgba(255, 215, 0, 0.3);
    }

    .floating-cta {
      background: linear-gradient(to right, #e94560, #00d4ff);
      color: white;
      padding: 0.875rem 1.25rem;
      border-radius: 50px;
      font-weight: 600;
      text-decoration: none;
      box-shadow: 0 8px 25px rgba(233, 69, 96, 0.4);
      transition: all 0.3s ease;
    }

    .floating-cta:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(233, 69, 96, 0.5);
    }

    .welcome-card {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.92));
      color: #1a1a2e;
      border-radius: 24px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.12);
      padding: 2.5rem;
      text-align: center;
      margin-bottom: 2rem;
      border: 2px solid rgba(255, 215, 0, 0.15);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .welcome-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #ffd700, #e94560, #00d4ff, #03dac6);
    }

    .icon-badge {
      width: 65px;
      height: 65px;
      background: linear-gradient(135deg, #ffd700, #e94560);
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      margin-bottom: 0.75rem;
      box-shadow: 0 12px 25px rgba(255, 215, 0, 0.4);
      border: 3px solid rgba(255, 255, 255, 0.3);
    }

    .service-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      display: block;
    }

    .admin-badge {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: linear-gradient(135deg, #ffd700, #ffb347);
      color: #1a1a2e;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 800;
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
      border: 2px solid rgba(255, 215, 0, 0.2);
    }

    .admin-section {
      background: linear-gradient(145deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05));
      border: 2px solid rgba(255, 215, 0, 0.2);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .admin-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #ffd700, #ffb347);
    }

    /* Loading skeleton */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
      .section-card {
        padding: 1.5rem;
      }
      
      .welcome-card {
        padding: 2rem;
      }

      .admin-section {
        padding: 1.5rem;
      }

      .card-item {
        padding: 1rem;
      }

      .floating-cta {
        padding: 0.75rem 1rem;
        font-size: 0.875rem;
      }

      .admin-badge {
        position: static;
        display: inline-block;
        margin-bottom: 1rem;
      }
    }

    /* Focus states for accessibility */
    .card-item:focus,
    .btn-primary:focus,
    .btn-secondary:focus,
    .btn-gold:focus {
      outline: 2px solid #ffd700;
      outline-offset: 2px;
    }
  </style>
</head>
<body>

<header class="sticky top-0 z-50 header-glass px-6 py-4 flex justify-between items-center">
  <div class="flex items-center space-x-3">
    <div class="icon-badge">
      <span class="text-white font-bold">A</span>
    </div>
    <h1 class="text-xl font-black text-primary">Aurora Admin</h1>
  </div>
  <div class="flex items-center gap-3">
    <span class="badge gold text-xs">👑 DIRIGENTE</span>
    <button id="logoutBtn" class="btn-secondary">Logout</button>
  </div>
</header>

<main class="max-w-6xl mx-auto px-6 py-10">

  <!-- Benvenuto Dirigente -->
  <section class="welcome-card">
    <div class="admin-badge">👑 Area Dirigenti</div>
    <h2 id="salutoPersonalizzato" class="text-3xl font-bold mb-3">Benvenuto Dirigente!</h2>
    <p id="dataOdierna" class="text-gray-600 text-lg mb-4">Caricamento...</p>
    <a href="areadirigenti.html" class="btn-gold">
      <span class="mr-2">🏛️</span>
      Accedi all'Area Riservata Dirigenti
    </a>
  </section>

  <!-- Accesso Rapido Admin -->
  <section class="admin-section">
    <h3 class="text-2xl font-bold mb-6 flex items-center text-white">
      <span class="mr-3 text-3xl">⚡</span>
      Controlli Amministrativi
    </h3>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div onclick="navigateTo('tessera.html')" class="card-item text-center" tabindex="0" role="button">
        <span class="service-icon">🆔</span>
        <div class="font-semibold">Tessere</div>
        <div class="text-sm text-gray-500 mt-1">Gestione ID</div>
      </div>
      <div onclick="navigateTo('strumenti.html')" class="card-item text-center" tabindex="0" role="button">
        <span class="service-icon">🛠️</span>
        <div class="font-semibold">Strumenti</div>
        <div class="text-sm text-gray-500 mt-1">Admin Tools</div>
      </div>
      <div onclick="navigateTo('virgilio.html')" class="card-item text-center" tabindex="0" role="button">
        <span class="service-icon">🤖</span>
        <div class="font-semibold">Virgilio AI</div>
        <div class="text-sm text-gray-500 mt-1">Assistente Pro</div>
      </div>
      <div onclick="navigateTo('profilo.html')" class="card-item text-center" tabindex="0" role="button">
        <span class="service-icon">👤</span>
        <div class="font-semibold">Profilo</div>
        <div class="text-sm text-gray-500 mt-1">Admin Account</div>
      </div>
    </div>
  </section>

  <!-- Accesso rapido Standard -->
  <section class="section-card">
    <h3 class="text-xl font-bold mb-6 flex items-center">
      <span class="mr-3 text-2xl">🚀</span>
      Accesso Rapido
    </h3>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div onclick="navigateTo('tessera.html')" class="card-item text-center" tabindex="0" role="button">
        <span class="service-icon">🆔</span>
        <div class="font-semibold">Tessera</div>
        <div class="text-sm text-gray-500 mt-1">ID Digitale</div>
      </div>
      <div onclick="navigateTo('strumenti.html')" class="card-item text-center" tabindex="0" role="button">
        <span class="service-icon">🛠️</span>
        <div class="font-semibold">Strumenti</div>
        <div class="text-sm text-gray-500 mt-1">Gestione</div>
      </div>
      <div onclick="navigateTo('virgilio.html')" class="card-item text-center" tabindex="0" role="button">
        <span class="service-icon">🤖</span>
        <div class="font-semibold">Virgilio AI</div>
        <div class="text-sm text-gray-500 mt-1">Assistente</div>
      </div>
      <div onclick="navigateTo('profilo.html')" class="card-item text-center" tabindex="0" role="button">
        <span class="service-icon">👤</span>
        <div class="font-semibold">Profilo</div>
        <div class="text-sm text-gray-500 mt-1">Account</div>
      </div>
    </div>
  </section>

  <!-- Notizie -->
  <section class="section-card">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-xl font-bold flex items-center">
        <span class="mr-3 text-2xl">📰</span>
        Ultime Notizie
        <span class="badge gold text-xs ml-2">Admin View</span>
      </h3>
      <a href="notifiche.html" class="btn-secondary">Gestisci tutte</a>
    </div>
    <div id="notizieContainer" class="space-y-4">
      <div class="news-item skeleton">
        <div class="h-4 rounded w-3/4 mb-2"></div>
        <div class="h-3 rounded w-1/2"></div>
      </div>
    </div>
  </section>

  <!-- Convenzioni -->
  <section class="section-card">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-xl font-bold flex items-center">
        <span class="mr-3 text-2xl">🏷️</span>
        Convenzioni Attive
        <span class="badge gold text-xs ml-2">Admin View</span>
      </h3>
      <a href="convenzioni.html" class="btn-secondary">Gestisci tutte</a>
    </div>
    <div id="convenzioniContainer" class="space-y-4">
      <div class="convenzione-item skeleton">
        <div class="h-4 rounded w-3/4 mb-2"></div>
        <div class="h-3 rounded w-1/2"></div>
      </div>
    </div>
  </section>

  <!-- Tutela -->
  <section class="section-card">
    <h3 class="text-xl font-bold mb-6 flex items-center">
      <span class="mr-3 text-2xl">🛡️</span>
      Servizi di Tutela BestBadge
      <span class="badge gold text-xs ml-2">Controllo Dirigenti</span>
    </h3>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div onclick="navigateTo('servizi.html')" class="card-item text-center" tabindex="0" role="button">
        <span class="service-icon">⚖️</span>
        <div class="font-semibold">Penale</div>
        <span class="badge aurora text-xs">Specializzato</span>
      </div>
      <div onclick="navigateTo('servizi.html')" class="card-item text-center" tabindex="0" role="button">
        <span class="service-icon">📋</span>
        <div class="font-semibold">Civile</div>
        <span class="badge success text-xs">Completo</span>
      </div>
      <div onclick="navigateTo('servizi.html')" class="card-item text-center" tabindex="0" role="button">
        <span class="service-icon">🏛️</span>
        <div class="font-semibold">Amministrativo</div>
        <span class="badge text-xs">Militare</span>
      </div>
      <div onclick="navigateTo('servizi.html')" class="card-item text-center" tabindex="0" role="button">
        <span class="service-icon">📊</span>
        <div class="font-semibold">Fiscale</div>
        <span class="badge text-xs">CAF</span>
      </div>
    </div>
  </section>

</main>

<!-- CTA -->
<a href="dirigenti.html" class="floating-cta fixed bottom-6 right-6 shadow-lg">
  👥 Contatta altri dirigenti
</a>

<!-- Supabase Script -->
<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
  const supabase = createClient(
    'https://lycrgzptkdkksukcwrld.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx5Y3JnenB0a2Rra3N1a2N3cmxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3ODQyMzAsImV4cCI6MjA2ODM2MDIzMH0.ZJGOXAMC3hKKrnwXHKEa2_Eh7ZpOKeLYvYlYneBiEfk'
  );

  async function init() {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) return location.href = '../login.html';

    // Controlla se l'utente ha i privilegi di dirigente
    const { data: profile } = await supabase.from('profiles').select('nome, ruoli').eq('id', user.id).single();
    const nome = profile?.nome || 'Utente';
    const ruoli = profile?.ruoli || ['USER'];

    // Verifica privilegi dirigente/admin
    if (!ruoli.includes('DIRIGENTE') && !ruoli.includes('ADMIN')) {
      // Reindirizza alla home normale se non è dirigente
      window.location.href = 'home.html';
      return;
    }

    const ora = new Date().getHours();
    const saluto = ora < 12 ? "Buongiorno" : ora < 18 ? "Buon pomeriggio" : "Buonasera";
    const titoloRuolo = ruoli.includes('ADMIN') ? 'Amministratore' : 'Dirigente';
    
    document.getElementById("salutoPersonalizzato").textContent = `${saluto}, ${titoloRuolo} ${nome}!`;
    document.getElementById("dataOdierna").textContent = new Date().toLocaleDateString('it-IT', {
      weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
    });

    loadNotizie();
    loadConvenzioni();
  }

  async function loadNotizie() {
    try {
      const { data } = await supabase
        .from('notizie')
        .select('id, titolo, contenuto, data_pubblicazione, priorita, icona, pubblicata')
        .order('data_pubblicazione', { ascending: false })
        .limit(4); // Mostra più notizie per i dirigenti, incluse quelle non pubblicate

      const container = document.getElementById("notizieContainer");
      if (!data || !data.length) {
        container.innerHTML = `
          <div class="news-item text-center py-6">
            <div class="text-3xl mb-3">📰</div>
            <p class="text-gray-600 font-semibold">Nessuna notizia disponibile</p>
            <p class="text-gray-500 text-sm mt-1">Controlla più tardi per aggiornamenti</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = data.map(n => `
        <div class="news-item cursor-pointer" onclick="viewNotizia('${n.id}')">
          <div class="flex items-start gap-3">
            <div class="text-2xl flex-shrink-0">${n.icona || '📰'}</div>
            <div class="flex-1">
              <div class="font-bold text-gray-900 text-base mb-2 flex items-center gap-2">
                ${n.titolo}
                ${!n.pubblicata ? '<span class="badge text-xs">🔒 Bozza</span>' : ''}
              </div>
              <p class="text-sm text-gray-700 mb-3 leading-relaxed">${n.contenuto.slice(0, 120)}${n.contenuto.length > 120 ? '...' : ''}</p>
              <div class="flex items-center gap-3">
                <span class="text-xs text-aurora font-bold bg-red-50 px-2 py-1 rounded-full">
                  ${new Date(n.data_pubblicazione).toLocaleDateString('it-IT')}
                </span>
                ${n.priorita === 'alta' ? '<span class="badge aurora text-xs">🔥 Importante</span>' : ''}
                ${n.priorita === 'urgente' ? '<span class="badge aurora text-xs">⚡ Urgente</span>' : ''}
                <span class="badge gold text-xs">👑 Admin</span>
              </div>
            </div>
          </div>
        </div>
      `).join('');
    } catch (error) {
      console.error('Errore caricamento notizie:', error);
      document.getElementById("notizieContainer").innerHTML = `
        <div class="news-item text-center py-6">
          <div class="text-3xl mb-3">⚠️</div>
          <p class="text-gray-600 font-semibold">Errore nel caricamento delle notizie</p>
          <p class="text-gray-500 text-sm mt-1">Riprova più tardi</p>
        </div>
      `;
    }
  }

  async function loadConvenzioni() {
    try {
      const { data } = await supabase
        .from('convenzioni')
        .select('id, nome_partner, descrizione, categoria, sconto_percentuale, icona, data_inizio, data_fine, attiva')
        .order('created_at', { ascending: false })
        .limit(5); // Mostra più convenzioni per i dirigenti, incluse quelle non attive

      const container = document.getElementById("convenzioniContainer");
      if (!data || !data.length) {
        container.innerHTML = `
          <div class="convenzione-item text-center py-6">
            <div class="text-3xl mb-3">🏷️</div>
            <p class="text-gray-600 font-semibold">Nessuna convenzione disponibile</p>
            <p class="text-gray-500 text-sm mt-1">Nuove offerte in arrivo presto</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = data.map(c => {
        const isNew = c.data_inizio && new Date(c.data_inizio) > new Date(Date.now() - 7*24*60*60*1000);
        const hasExpiry = c.data_fine && new Date(c.data_fine) > new Date();
        
        return `
          <div class="convenzione-item cursor-pointer" onclick="viewConvenzione('${c.id}')">
            <div class="flex items-start gap-3">
              <div class="text-2xl flex-shrink-0">${c.icona || '🏷️'}</div>
              <div class="flex-1">
                <div class="font-bold text-gray-900 text-base mb-2 flex items-center gap-2 flex-wrap">
                  ${c.nome_partner}
                  ${isNew ? '<span class="badge aurora text-xs">✨ Nuovo</span>' : ''}
                  ${!c.attiva ? '<span class="badge text-xs">⏸️ Inattiva</span>' : ''}
                </div>
                <p class="text-sm text-gray-700 mb-3 leading-relaxed">${c.descrizione?.slice(0, 100) || 'Offerta speciale riservata ai soci'}${c.descrizione && c.descrizione.length > 100 ? '...' : ''}</p>
                <div class="flex items-center gap-2 flex-wrap">
                  <span class="badge text-xs">${c.categoria}</span>
                  ${c.sconto_percentuale ? `<span class="badge success text-xs">💰 -${c.sconto_percentuale}%</span>` : ''}
                  ${hasExpiry ? `<span class="text-xs text-gray-500">Scade: ${new Date(c.data_fine).toLocaleDateString('it-IT')}</span>` : ''}
                  <span class="badge gold text-xs">👑 Admin</span>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    } catch (error) {
      console.error('Errore caricamento convenzioni:', error);
      document.getElementById("convenzioniContainer").innerHTML = `
        <div class="convenzione-item text-center py-6">
          <div class="text-3xl mb-3">⚠️</div>
          <p class="text-gray-600 font-semibold">Errore nel caricamento delle convenzioni</p>
          <p class="text-gray-500 text-sm mt-1">Riprova più tardi</p>
        </div>
      `;
    }
  }

  // Funzioni per visualizzare dettagli (da implementare se necessario)
  window.viewNotizia = (id) => {
    // Implementa navigazione a dettaglio notizia con privilegi admin
    console.log('Visualizza notizia (Admin):', id);
    // window.location.href = `admin/notizia.html?id=${id}`;
  };

  window.viewConvenzione = (id) => {
    // Implementa navigazione a dettaglio convenzione con privilegi admin
    console.log('Visualizza convenzione (Admin):', id);
    // window.location.href = `admin/convenzione.html?id=${id}`;
  };

  window.navigateTo = (url) => window.location.href = url;

  // Keyboard navigation for cards
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && e.target.classList.contains('card-item')) {
      e.target.click();
    }
  });

  document.getElementById("logoutBtn").addEventListener("click", async () => {
    if (confirm("Vuoi davvero uscire dall'area dirigenti?")) {
      await supabase.auth.signOut();
      location.href = '../login.html';
    }
  });

  init();
</script>

</body>
</html>
