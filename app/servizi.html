<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Servizi - MyApp</title>

  <!-- PWA & meta -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1a1a2e">
  <link rel="icon" sizes="16x16" href="/public/icons/favicon-16x16.png">
  <link rel="apple-touch-icon" href="/public/icons/apple-touch-icon.png">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1a1a2e',
            secondary: '#16213e',
            accent: '#0f3460',
            aurora: '#e94560',
            cyan: '#00d4ff',
            magenta: '#ff006e',
            gold: '#ffd700',
            teal: '#03dac6',
            dark: '#0a0a23',
            light: '#f8fafc',
            textDark: '#1C1C1E',
            backgroundLight: '#F4F4F8',
          },
          screens: {
            xs: '320px',
            sm: '640px',
            md: '768px',
            lg: '1024px',
            xl: '1280px',
            '2xl': '1536px',
            '3xl': '1920px',
            '4xl': '2560px',
          }
        }
      }
    }
  </script>

  <style>
    :root {
      --gradient-aurora: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #e94560 75%, #00d4ff 100%);
      --gradient-cyber: linear-gradient(135deg, #0a0a23 0%, #1a1a2e 50%, #00d4ff 100%);
      --gradient-magic: linear-gradient(135deg, #ff006e 0%, #e94560 50%, #03dac6 100%);
    }

    body {
      background: var(--gradient-aurora);
      background-size: 400% 400%;
      animation: aurora 20s ease infinite;
      min-height: 100vh;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    }

    @keyframes aurora {
      0%, 100% { background-position: 0% 50%; }
      25% { background-position: 100% 50%; }
      50% { background-position: 100% 100%; }
      75% { background-position: 0% 100%; }
    }

    /* ===== TYPOGRAPHY SYSTEM ===== */
    .text-hero { @apply text-2xl xs:text-xl sm:text-2xl md:text-3xl lg:text-4xl font-black text-textDark; }
    .text-title { @apply text-xl xs:text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold text-textDark; }
    .text-subtitle { @apply text-lg xs:text-base sm:text-lg md:text-xl lg:text-2xl font-semibold text-textDark; }
    .text-body { @apply text-sm xs:text-xs sm:text-sm md:text-base lg:text-lg text-gray-700; }
    .text-caption { @apply text-xs xs:text-xs sm:text-sm md:text-sm lg:text-base text-gray-600; }

    /* ===== CONTAINER SYSTEM ===== */
    .ultra-card {
      @apply bg-white border-4 rounded-2xl shadow-lg p-4 sm:p-6 lg:p-8;
      border-image: linear-gradient(135deg, #00d4ff, #e94560, #03dac6) 1;
      border-style: solid;
      border-width: 3px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }
    .ultra-card:hover {
      background: rgba(255, 255, 255, 0.98);
      box-shadow: 0 20px 40px rgba(233, 69, 96, 0.15);
      transform: translateY(-2px);
    }

    .ultra-button {
      @apply bg-gradient-to-r from-aurora to-magenta text-white font-bold py-3 px-6 rounded-xl shadow-lg;
      transition: all 0.3s ease;
    }
    .ultra-button:hover {
      @apply shadow-2xl;
      transform: translateY(-2px) scale(1.02);
    }

    .ultra-tab {
      @apply text-textDark font-semibold py-3 px-4 rounded-lg transition-all duration-300;
    }
    .ultra-tab.active {
      @apply bg-primary text-white shadow-lg;
    }
    .ultra-tab:not(.active):hover {
      @apply bg-gray-100;
    }

    /* ===== RESPONSIVE SERVICE CARDS ===== */
    .service-item {
      @apply bg-white/90 rounded-xl p-3 transition-all duration-300;
      backdrop-filter: blur(8px);
      border: 2px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 15px rgba(0, 212, 255, 0.1);
    }
    .service-item:hover {
      background: rgba(255, 255, 255, 0.95);
      border-color: rgba(233, 69, 96, 0.4);
      box-shadow: 0 8px 25px rgba(233, 69, 96, 0.2);
      transform: translateY(-1px);
    }

    .service-grid {
      @apply grid gap-3;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    }

    /* ===== RESPONSIVE BREAKPOINTS ===== */
    @media (max-width: 320px) {
      .hero-container { @apply p-3; }
      .service-card { @apply p-3; }
      .ultra-tab { @apply text-xs py-2 px-2; }
    }

    @media (min-width: 321px) and (max-width: 640px) {
      .hero-container { @apply p-4; }
      .service-card { @apply p-4; }
      .service-grid { grid-template-columns: 1fr; }
    }

    @media (min-width: 641px) and (max-width: 1024px) {
      .hero-container { @apply p-6; }
      .service-card { @apply p-6; }
      .service-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (min-width: 1025px) and (max-width: 1280px) {
      .container-responsive { @apply max-w-4xl; }
      .service-grid { grid-template-columns: repeat(3, 1fr); }
    }

    @media (min-width: 1281px) and (max-width: 1536px) {
      .container-responsive { @apply max-w-5xl; }
      .service-grid { grid-template-columns: repeat(4, 1fr); }
    }

    @media (min-width: 1537px) and (max-width: 1920px) {
      .container-responsive { @apply max-w-6xl; }
    }

    @media (min-width: 1921px) and (max-width: 2560px) {
      .container-responsive { @apply max-w-7xl; }
    }

    @media (min-width: 2561px) {
      .container-responsive { max-width: 80%; }
    }

    /* ===== ANIMATIONS ===== */
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes counterUp {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .animate-slide-in { animation: slideIn 0.6s ease-out; }
    .animate-counter { animation: counterUp 0.8s ease-out; }

    /* ===== ACCESSIBILITY ===== */
    .focus-visible {
      @apply outline-none ring-4 ring-primary ring-opacity-50;
    }

    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* ===== PRINT STYLES ===== */
    @media print {
      body { background: white !important; }
      .ultra-card { border: 2px solid #000 !important; box-shadow: none !important; }
      .no-print { display: none !important; }
    }
  </style>
</head>
<body>
  <!-- Loading Aurora Boreale 2025 -->
  <div id="loading" class="no-print fixed inset-0 bg-gradient-to-br from-primary/90 via-secondary/90 to-accent/90 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="ultra-card text-center border-aurora/30">
      <div class="w-16 h-16 border-4 border-aurora border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
      <p class="text-subtitle text-primary">Caricamento servizi…</p>
      <p class="text-caption mt-2 text-aurora">Aurora Boreale 2025 • Ultra-Leggibile</p>
    </div>
  </div>

  <!-- Header Ultra-Responsive -->
  <header class="w-full px-4 py-4 sm:py-6 no-print">
    <div class="container-responsive mx-auto flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <button 
          onclick="history.back()" 
          class="text-primary text-2xl sm:text-3xl hover:text-aurora transition-colors p-2 rounded-lg hover:bg-white"
          aria-label="Torna indietro"
        >
          ←
        </button>
        <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-cyan to-teal rounded-full flex items-center justify-center border-4 border-white shadow-lg">
          <span class="text-white font-bold text-lg sm:text-xl">🛡️</span>
        </div>
        <h1 class="text-hero text-primary">Servizi</h1>
      </div>
      <button 
        id="loginBtn" 
        class="ultra-button text-xs sm:text-sm px-3 py-2 sm:px-4 sm:py-2"
        aria-label="Accedi al sistema"
      >
        Accedi
      </button>
    </div>
  </header>

  <main class="container-responsive mx-auto px-4 pb-24 animate-slide-in">
    <!-- Hero Ultra-Leggibile -->
    <div class="ultra-card hero-container mb-6 text-center bg-gradient-to-r from-primary to-secondary text-white">
      <div class="w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4 border-4 border-white/30">
        <span class="text-3xl sm:text-4xl lg:text-5xl">⚖️</span>
      </div>
      <h2 class="text-title mb-2 text-white">BestBadge</h2>
      <p class="text-body text-white/90 mb-4 max-w-2xl mx-auto">
        Tutela legale, fiscale e di patronato per il Sindacato Carabinieri
      </p>
      <div class="flex flex-wrap justify-center gap-2 text-caption">
        <span class="bg-white/20 px-3 py-1 rounded-full border border-white/30">ISO 9001:2015</span>
        <span class="bg-white/20 px-3 py-1 rounded-full border border-white/30">ISO 14001:2015</span>
        <span class="bg-white/20 px-3 py-1 rounded-full border border-white/30">ISO 45001:2018</span>
      </div>
    </div>

    <!-- Statistics Counter -->
    <div class="ultra-card mb-6">
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-center">
        <div class="animate-counter">
          <div class="text-2xl sm:text-3xl font-bold text-green-600" id="counter-response">24-72h</div>
          <div class="text-caption font-semibold text-green-600">Tempo Risposta</div>
        </div>
        <div class="animate-counter">
          <div class="text-2xl sm:text-3xl font-bold text-blue-600" id="counter-coverage">100%</div>
          <div class="text-caption font-semibold text-blue-600">Copertura Territorio</div>
        </div>
        <div class="animate-counter">
          <div class="text-2xl sm:text-3xl font-bold text-purple-600" id="counter-services">12+</div>
          <div class="text-caption font-semibold text-purple-600">Servizi Attivi</div>
        </div>
        <div class="animate-counter">
          <div class="text-2xl sm:text-3xl font-bold text-orange-600" id="counter-support">24/7</div>
          <div class="text-caption font-semibold text-orange-600">Supporto</div>
        </div>
      </div>
    </div>

    <!-- Search Bar -->
    <div class="ultra-card mb-6">
      <div class="relative">
        <input 
          type="text" 
          id="searchServices" 
          placeholder="🔍 Cerca servizi... (Ctrl+K)"
          class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 pr-12 focus:border-primary focus:ring-4 focus:ring-primary/20 transition-all text-body"
          aria-label="Cerca tra i servizi disponibili"
        >
        <button 
          id="clearSearch" 
          class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-primary transition-colors hidden"
          aria-label="Cancella ricerca"
        >
          ✕
        </button>
      </div>
    </div>

    <!-- Tabs Ultra-Responsive -->
    <div class="ultra-card mb-6">
      <div class="flex flex-wrap gap-2 sm:gap-4" role="tablist" aria-label="Categorie servizi">
        <button 
          class="ultra-tab active flex-1 min-w-0" 
          data-tab="legale" 
          role="tab" 
          aria-selected="true" 
          aria-controls="tab-legale"
          id="tab-button-legale"
        >
          📋 Legale
        </button>
        <button 
          class="ultra-tab flex-1 min-w-0" 
          data-tab="fiscale" 
          role="tab" 
          aria-selected="false" 
          aria-controls="tab-fiscale"
          id="tab-button-fiscale"
        >
          📊 Fiscale
        </button>
        <button 
          class="ultra-tab flex-1 min-w-0" 
          data-tab="admin" 
          role="tab" 
          aria-selected="false" 
          aria-controls="tab-admin"
          id="tab-button-admin"
        >
          🏛️ Amministrativo
        </button>
      </div>
    </div>

    <!-- Tab Legale -->
    <div id="tab-legale" class="tab-content" role="tabpanel" aria-labelledby="tab-button-legale">
      <div class="ultra-card service-card mb-6">
        <h3 class="text-subtitle mb-4 flex items-center">
          <span class="text-2xl mr-3">📋</span>
          Area Legale Civile
        </h3>
        <div class="space-y-4">
          <div class="service-item">
            <div class="flex items-start space-x-3">
              <span class="text-2xl">🏢</span>
              <div>
                <strong class="text-body font-bold">Diritto delle Società</strong>
                <ul class="text-caption mt-1 space-y-1">
                  <li>• Fusioni e scissioni aziendali</li>
                  <li>• Contrattualistica commerciale</li>
                  <li>• Consulenza societaria</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="service-item">
            <div class="flex items-start space-x-3">
              <span class="text-2xl">🏠</span>
              <div>
                <strong class="text-body font-bold">Diritto delle Proprietà</strong>
                <ul class="text-caption mt-1 space-y-1">
                  <li>• Compravendite immobiliari</li>
                  <li>• Contratti di locazione</li>
                  <li>• Procedure di sfratto</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="service-item">
            <div class="flex items-start space-x-3">
              <span class="text-2xl">👥</span>
              <div>
                <strong class="text-body font-bold">Diritto del Lavoro</strong>
                <ul class="text-caption mt-1 space-y-1">
                  <li>• Vertenze lavorative</li>
                  <li>• Infortuni sul lavoro</li>
                  <li>• Condotta antisindacale</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="service-item">
            <div class="flex items-start space-x-3">
              <span class="text-2xl">👨‍👩‍👧‍👦</span>
              <div>
                <strong class="text-body font-bold">Diritto di Famiglia</strong>
                <ul class="text-caption mt-1 space-y-1">
                  <li>• Separazioni e divorzi</li>
                  <li>• Assegni di mantenimento</li>
                  <li>• Procedure di adozione</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="ultra-card service-card mb-6">
        <h3 class="text-subtitle mb-4 flex items-center">
          <span class="text-2xl mr-3">⚖️</span>
          Area Penale
        </h3>
        <div class="bg-blue-50 border-4 border-blue-200 rounded-xl p-4 mb-4">
          <div class="flex items-start space-x-3">
            <span class="text-2xl">🎖️</span>
            <div>
              <strong class="text-body text-blue-800 font-bold">Penale Militare</strong>
              <p class="text-caption text-blue-600 mt-1">
                Consulenza e assistenza in procedimenti penali militari. Copertura anche in caso di dolo.
              </p>
            </div>
          </div>
        </div>
        <div class="service-grid">
          <div class="service-item text-center">
            <span class="text-3xl block mb-2">🏗️</span>
            <span class="text-caption font-bold">Reati Edilizi</span>
          </div>
          <div class="service-item text-center">
            <span class="text-3xl block mb-2">💰</span>
            <span class="text-caption font-bold">Truffe</span>
          </div>
          <div class="service-item text-center">
            <span class="text-3xl block mb-2">🌍</span>
            <span class="text-caption font-bold">Ambientali</span>
          </div>
          <div class="service-item text-center">
            <span class="text-3xl block mb-2">👶</span>
            <span class="text-caption font-bold">Su Minori</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Fiscale -->
    <div id="tab-fiscale" class="tab-content hidden" role="tabpanel" aria-labelledby="tab-button-fiscale">
      <div class="ultra-card service-card mb-6">
        <h3 class="text-subtitle mb-4 flex items-center">
          <span class="text-2xl mr-3">📊</span>
          Servizi Fiscali F.I.TE.S.C.
        </h3>
        <div class="space-y-4">
          <div class="bg-green-50 border-4 border-green-200 rounded-xl p-4">
            <div class="flex items-start space-x-3">
              <span class="text-2xl">💼</span>
              <div>
                <strong class="text-body text-green-800 font-bold">Assistenza Fiscale</strong>
                <ul class="text-caption text-green-600 space-y-1 mt-2">
                  <li>• Dichiarazioni 730 e Redditi PF</li>
                  <li>• Calcolo ISEE e RED</li>
                  <li>• Bonus ristrutturazioni e detrazioni</li>
                  <li>• Consulenza tributaria specializzata</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="bg-blue-50 border-4 border-blue-200 rounded-xl p-4">
            <div class="flex items-start space-x-3">
              <span class="text-2xl">🏛️</span>
              <div>
                <strong class="text-body text-blue-800 font-bold">Servizi di Patronato</strong>
                <ul class="text-caption text-blue-600 space-y-1 mt-2">
                  <li>• Pratiche pensionistiche</li>
                  <li>• NASpI e disoccupazione</li>
                  <li>• Assegni familiari</li>
                  <li>• Invalidità civile e accompagnamento</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Amministrativo -->
    <div id="tab-admin" class="tab-content hidden" role="tabpanel" aria-labelledby="tab-button-admin">
      <div class="ultra-card service-card mb-6">
        <h3 class="text-subtitle mb-4 flex items-center">
          <span class="text-2xl mr-3">🏛️</span>
          Materie Amministrative
        </h3>
        <div class="space-y-4">
          <div class="bg-purple-50 border-4 border-purple-200 rounded-xl p-4">
            <div class="flex items-start space-x-3">
              <span class="text-2xl">🎖️</span>
              <div>
                <strong class="text-body text-purple-800 font-bold">Procedure Militari</strong>
                <ul class="text-caption text-purple-600 space-y-1 mt-2">
                  <li>• Trasferimenti art. 398 RGA</li>
                  <li>• Ricorsi gerarchici</li>
                  <li>• Procedure disciplinari</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="bg-orange-50 border-4 border-orange-200 rounded-xl p-4">
            <div class="flex items-start space-x-3">
              <span class="text-2xl">⚖️</span>
              <div>
                <strong class="text-body text-orange-800 font-bold">Ricorsi TAR</strong>
                <p class="text-caption text-orange-600 mt-1">
                  Assistenza per ricorsi al Tribunale Amministrativo Regionale, previa valutazione di fattibilità condivisa.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Condizioni e Vantaggi -->
    <div class="ultra-card service-card mb-6">
      <h3 class="text-subtitle mb-4 flex items-center">
        <span class="text-2xl mr-3">✨</span>
        Condizioni e Vantaggi
      </h3>
      <div class="space-y-4">
        <div class="flex items-center space-x-3 p-3 service-item">
          <span class="text-2xl text-green-500">✅</span>
          <div class="text-body">
            <strong>Nucleo familiare convivente:</strong> Copertura estesa a tutti i componenti
          </div>
        </div>
        <div class="flex items-center space-x-3 p-3 service-item">
          <span class="text-2xl text-green-500">✅</span>
          <div class="text-body">
            <strong>Tutela fuori servizio:</strong> Assistenza anche per questioni private
          </div>
        </div>
        <div class="flex items-center space-x-3 p-3 service-item">
          <span class="text-2xl text-green-500">✅</span>
          <div class="text-body">
            <strong>Collaborazione NSC:</strong> Network specializzato di consulenti
          </div>
        </div>
      </div>
    </div>

    <!-- Richiedi Assistenza -->
    <div class="ultra-card service-card mb-6">
      <h3 class="text-subtitle mb-4 flex items-center">
        <span class="text-2xl mr-3">📞</span>
        Richiedi Assistenza
      </h3>
      <p class="text-body text-gray-600 mb-4">
        Compila il modulo per ricevere supporto qualificato entro 48-72 ore.
      </p>
      <button 
        id="openFormBtn" 
        class="ultra-button w-full"
        aria-label="Apri il modulo per richiedere assistenza"
      >
        📝 Apri Modulo Assistenza
      </button>
    </div>

    <!-- Contatti BestBadge -->
    <div class="ultra-card service-card">
      <h3 class="text-subtitle mb-4 flex items-center">
        <span class="text-2xl mr-3">📧</span>
        Contatti BestBadge
      </h3>
      <div class="space-y-3">
        <a 
          href="mailto:info@assosafe.org" 
          class="flex items-center space-x-3 p-3 service-item hover:bg-blue-50 transition-colors"
          aria-label="Invia email a info@assosafe.org"
        >
          <span class="text-2xl">✉️</span>
          <span class="text-body text-textDark">info@assosafe.org</span>
        </a>
        <a 
          href="https://www.bestbadge.org" 
          target="_blank" 
          rel="noopener noreferrer"
          class="flex items-center space-x-3 p-3 service-item hover:bg-blue-50 transition-colors"
          aria-label="Visita il sito web bestbadge.org (si apre in una nuova finestra)"
        >
          <span class="text-2xl">🌐</span>
          <span class="text-body text-textDark">www.bestbadge.org</span>
        </a>
        <div class="flex items-center space-x-3 p-3 service-item">
          <span class="text-2xl">🏢</span>
          <span class="text-body text-textDark">In partnership con Fondazione ASSOSAFE</span>
        </div>
      </div>
    </div>
  </main>

  <!-- Modal Ultra-Leggibile -->
  <div id="assistanceModal" class="no-print fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="ultra-card w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-4">
        <h3 id="modal-title" class="text-subtitle">📝 Richiesta Supporto</h3>
        <button 
          id="closeModal" 
          class="text-gray-500 hover:text-primary text-2xl p-2 rounded-lg hover:bg-gray-100 transition-colors"
          aria-label="Chiudi modulo"
        >
          ✕
        </button>
      </div>
      <form id="assistanceForm" class="space-y-4">
        <div>
          <label for="nome" class="block text-body font-semibold mb-2">Nome e Cognome *</label>
          <input 
            name="nome" 
            id="nome"
            type="text" 
            placeholder="Inserisci nome completo" 
            required 
            class="w-full border-2 border-gray-200 rounded-lg px-3 py-2 focus:border-primary focus:ring-4 focus:ring-primary/20 transition-all"
            aria-required="true"
          >
        </div>
        <div>
          <label for="email" class="block text-body font-semibold mb-2">Email *</label>
          <input 
            name="email" 
            id="email"
            type="email" 
            placeholder="tua.email@example.com" 
            required 
            class="w-full border-2 border-gray-200 rounded-lg px-3 py-2 focus:border-primary focus:ring-4 focus:ring-primary/20 transition-all"
            aria-required="true"
          >
        </div>
        <div>
          <label for="tipo" class="block text-body font-semibold mb-2">Tipo di assistenza *</label>
          <select 
            name="tipo" 
            id="tipo"
            required 
            class="w-full border-2 border-gray-200 rounded-lg px-3 py-2 focus:border-primary focus:ring-4 focus:ring-primary/20 transition-all"
            aria-required="true"
          >
            <option value="">Seleziona categoria</option>
            <option value="civile">📋 Diritto Civile</option>
            <option value="penale">⚖️ Diritto Penale</option>
            <option value="lavoro">👥 Diritto del Lavoro</option>
            <option value="famiglia">👨‍👩‍👧‍👦 Diritto di Famiglia</option>
            <option value="fiscale">📊 Assistenza Fiscale</option>
            <option value="patronato">🏛️ Patronato</option>
            <option value="amministrativo">🏛️ Diritto Amministrativo</option>
            <option value="altro">❓ Altro</option>
          </select>
        </div>
        <div>
          <label for="descrizione" class="block text-body font-semibold mb-2">Descrizione del caso *</label>
          <textarea 
            name="descrizione" 
            id="descrizione"
            rows="4" 
            placeholder="Descrivi dettagliatamente la tua situazione..." 
            required 
            class="w-full border-2 border-gray-200 rounded-lg px-3 py-2 focus:border-primary focus:ring-4 focus:ring-primary/20 transition-all resize-vertical"
            aria-required="true"
          ></textarea>
          <p class="text-caption mt-1">Più dettagli fornisci, migliore sarà l'assistenza che potremo offrirti.</p>
        </div>
        <div class="flex space-x-3">
          <button 
            type="button" 
            id="cancelForm"
            class="flex-1 bg-gray-200 text-gray-700 py-3 px-4 rounded-xl font-semibold hover:bg-gray-300 transition-colors"
          >
            Annulla
          </button>
          <button 
            type="submit" 
            class="flex-1 ultra-button"
            id="submitForm"
          >
            📨 Invia Richiesta
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Bottom Navigation Aurora Theme -->
  <nav class="no-print fixed bottom-0 left-0 right-0 px-4 py-3 bg-white/95 backdrop-blur-md border-t-4" style="border-image: linear-gradient(90deg, #00d4ff, #e94560, #03dac6) 1;">
    <div class="flex justify-around items-center container-responsive mx-auto">
      <a 
        href="index.html" 
        onclick="smartHomeRedirect(event)" 
        class="flex flex-col items-center text-caption text-gray-600 hover:text-primary transition-colors p-2 rounded-lg hover:bg-gray-100"
        aria-label="Vai alla home"
      >
        <svg class="w-6 h-6 sm:w-7 sm:h-7 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m3 12 2-2 7-7 7 7M5 10v10a1 1 0 0 0 1 1h3m10-11 2 2m-2-2v10a1 1 0 0 1-1 1h-3m-6 0a1 1 0 0 0 1-1v-4a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1m-6 0h6"/>
        </svg>
        Home
      </a>
      <a 
        href="convenzioni.html" 
        class="flex flex-col items-center text-caption text-gray-600 hover:text-primary transition-colors p-2 rounded-lg hover:bg-gray-100"
        aria-label="Vai alle convenzioni"
      >
        <svg class="w-6 h-6 sm:w-7 sm:h-7 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
        Convenzioni
      </a>
      <a 
        href="servizi.html" 
        class="flex flex-col items-center text-caption text-primary font-bold transition-colors p-2 rounded-lg bg-primary/10"
        aria-label="Servizi (pagina corrente)"
        aria-current="page"
      >
        <svg class="w-6 h-6 sm:w-7 sm:h-7 mb-1" fill="currentColor" viewBox="0 0 24 24">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        Servizi
      </a>
      <a 
        href="contatti.html" 
        class="flex flex-col items-center text-caption text-gray-600 hover:text-primary transition-colors p-2 rounded-lg hover:bg-gray-100"
        aria-label="Vai ai contatti"
      >
        <svg class="w-6 h-6 sm:w-7 sm:h-7 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
        </svg>
        Contatti
      </a>
    </div>
  </nav>

  <!-- Floating Help Button -->
  <button 
    id="helpBtn" 
    class="no-print fixed bottom-20 right-4 w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-r from-teal to-cyan text-white rounded-full shadow-lg hover:shadow-2xl transition-all duration-300 flex items-center justify-center z-40"
    aria-label="Aiuto e supporto"
    title="Serve aiuto? Clicca qui!"
  >
    <span class="text-xl sm:text-2xl">❓</span>
  </button>

  <script>
    /* ===== CONFIGURATION ===== */
    const APP_CONFIG = {
      supabaseUrl: 'https://lycrgzptkdkksukcwrld.supabase.co',
      supabaseKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx5Y3JnenB0a2Rra3N1a2N3cmxkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3ODQyMzAsImV4cCI6MjA2ODM2MDIzMH0.ZJGOXAMC3hKKrnwXHKEa2_Eh7ZpOKeLYvYlYneBiEfk',
      version: '2.1.0',
      environment: 'production'
    };

    /* ===== UTILITY FUNCTIONS ===== */
    const showLoading = (message = 'Caricamento...') => {
      const loading = document.getElementById('loading');
      const text = loading.querySelector('p');
      if (text) text.textContent = message;
      loading.classList.remove('hidden');
    };

    const hideLoading = () => {
      document.getElementById('loading').classList.add('hidden');
    };

    const showNote = (msg, type = 'info', duration = 4000) => {
      const div = document.createElement('div');
      const bgColor = {
        'success': 'bg-green-500',
        'error': 'bg-red-500',
        'warning': 'bg-yellow-500',
        'info': 'bg-blue-500'
      };
      
      div.className = `fixed top-20 right-4 z-50 px-4 py-3 rounded-xl text-white font-semibold shadow-lg max-w-sm animate-slide-in ${bgColor[type] || bgColor.info}`;
      div.innerHTML = `
        <div class="flex items-center space-x-2">
          <span>${msg}</span>
          <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white/80 hover:text-white">✕</button>
        </div>
      `;
      document.body.appendChild(div);
      setTimeout(() => div.remove(), duration);
    };

    /* ===== SEARCH FUNCTIONALITY ===== */
    let searchTimeout;
    const searchInput = document.getElementById('searchServices');
    const clearBtn = document.getElementById('clearSearch');

    const debounceSearch = (func, delay) => {
      return function(args) {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => func.apply(this, [args]), delay);
      }
    };

    const performSearch = (query) => {
      const searchTerm = query.toLowerCase().trim();
      const allServiceItems = document.querySelectorAll('.service-item, .ultra-card');
      let visibleCount = 0;

      allServiceItems.forEach(item => {
        const text = item.textContent.toLowerCase();
        const isVisible = searchTerm === '' || text.includes(searchTerm);
        
        if (isVisible) {
          item.style.display = '';
          item.classList.remove('opacity-50');
          visibleCount++;
        } else {
          item.style.display = 'none';
          item.classList.add('opacity-50');
        }
      });

      // Show/hide clear button
      clearBtn.classList.toggle('hidden', searchTerm === '');
      
      // Show results message
      if (searchTerm !== '') {
        showNote(`🔍 Trovati ${visibleCount} risultati per "${query}"`, 'info', 2000);
      }
    };

    const debouncedSearch = debounceSearch(performSearch, 300);

    searchInput.addEventListener('input', (e) => {
      debouncedSearch(e.target.value);
    });

    clearBtn.addEventListener('click', () => {
      searchInput.value = '';
      performSearch('');
      searchInput.focus();
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 'k') {
        e.preventDefault();
        searchInput.focus();
      }
      if (e.key === 'Escape') {
        searchInput.value = '';
        performSearch('');
      }
    });

    /* ===== TAB FUNCTIONALITY ===== */
    const initTabs = () => {
      document.querySelectorAll('.ultra-tab').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          
          // Update tab buttons
          document.querySelectorAll('.ultra-tab').forEach(b => {
            b.classList.remove('active');
            b.setAttribute('aria-selected', 'false');
          });
          
          btn.classList.add('active');
          btn.setAttribute('aria-selected', 'true');
          
          // Update tab content
          document.querySelectorAll('.tab-content').forEach(tc => {
            tc.classList.add('hidden');
          });
          
          const targetTab = document.getElementById(`tab-${btn.dataset.tab}`);
          if (targetTab) {
            targetTab.classList.remove('hidden');
          }
          
          // Analytics
          console.log(`Tab switched to: ${btn.dataset.tab}`);
          
          // Clear search when switching tabs
          if (searchInput.value) {
            searchInput.value = '';
            performSearch('');
          }
        });

        // Keyboard navigation for tabs
        btn.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            btn.click();
          }
        });
      });
    };

    /* ===== MODAL FUNCTIONALITY ===== */
    const modal = document.getElementById('assistanceModal');
    const openBtn = document.getElementById('openFormBtn');
    const closeBtn = document.getElementById('closeModal');
    const cancelBtn = document.getElementById('cancelForm');
    const form = document.getElementById('assistanceForm');

    const openModal = () => {
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      document.getElementById('nome').focus();
      
      // Track modal opening
      console.log('Assistance modal opened');
    };

    const closeModal = () => {
      modal.classList.add('hidden');
      document.body.style.overflow = '';
      
      // Clear form
      form.reset();
      
      console.log('Assistance modal closed');
    };

    openBtn.addEventListener('click', openModal);
    closeBtn.addEventListener('click', closeModal);
    cancelBtn.addEventListener('click', closeModal);

    // Close modal on escape key or outside click
    modal.addEventListener('click', (e) => {
      if (e.target === modal) closeModal();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
        closeModal();
      }
    });

    /* ===== FORM SUBMISSION ===== */
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitForm');
      const originalText = submitBtn.innerHTML;
      
      try {
        // Show loading state
        submitBtn.innerHTML = '⏳ Invio in corso...';
        submitBtn.disabled = true;
        
        // Simulate API call
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // Success
        showNote('✅ Richiesta inviata con successo! Ti contatteremo entro 48-72 ore.', 'success', 6000);
        closeModal();
        
        // Analytics
        console.log('Form submitted successfully', {
          tipo: form.tipo.value,
          timestamp: new Date().toISOString()
        });
        
      } catch (error) {
        console.error('Form submission error:', error);
        showNote('❌ Errore nell\'invio. Riprova tra qualche minuto.', 'error');
      } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    });

    /* ===== COUNTER ANIMATIONS ===== */
    const animateCounters = () => {
      const counters = [
        { id: 'counter-response', final: '24-72h' },
        { id: 'counter-coverage', final: '100%' },
        { id: 'counter-services', final: '12+' },
        { id: 'counter-support', final: '24/7' }
      ];

      counters.forEach(counter => {
        const element = document.getElementById(counter.id);
        if (element) {
          element.style.opacity = '0';
          element.style.transform = 'scale(0.8)';
          
          setTimeout(() => {
            element.style.opacity = '1';
            element.style.transform = 'scale(1)';
            element.textContent = counter.final;
          }, Math.random() * 1000 + 500);
        }
      });
    };

    /* ===== SMART HOME REDIRECT ===== */
    async function smartHomeRedirect(e) {
      if (e) e.preventDefault();
      
      showLoading('Verifica autenticazione...');
      
      try {
        const { createClient } = window.supabase;
        const supabase = createClient(APP_CONFIG.supabaseUrl, APP_CONFIG.supabaseKey);
        
        const { data: { user }, error } = await supabase.auth.getUser();
        
        if (error || !user) {
          window.location.href = 'login.html';
          return;
        }
        
        // Get user profile
        const { data: profile } = await supabase
          .from('profiles')
          .select('ruoli')
          .eq('id', user.id)
          .single();
        
        const roles = profile?.ruoli || ['USER'];
        
        if (roles.includes('DIRIGENTE') || roles.includes('ADMIN')) {
          window.location.href = 'app/home_dirigenti.html';
        } else {
          window.location.href = 'app/home.html';
        }
        
      } catch (error) {
        console.error('Redirect error:', error);
        showNote('❌ Errore di connessione. Riprova.', 'error');
        window.location.href = 'index.html';
      } finally {
        hideLoading();
      }
    }

    /* ===== HELP FUNCTIONALITY ===== */
    document.getElementById('helpBtn').addEventListener('click', () => {
      const helpMessages = [
        '💡 Usa Ctrl+K per cercare rapidamente tra i servizi',
        '📋 Clicca sui tab per esplorare le diverse categorie',
        '📞 Compila il modulo per richiedere assistenza personalizzata',
        '⚖️ Tutti i servizi includono copertura per il nucleo familiare',
        '🏛️ BestBadge opera in partnership con Fondazione ASSOSAFE'
      ];
      
      const randomMessage = helpMessages[Math.floor(Math.random() * helpMessages.length)];
      showNote(randomMessage, 'info', 5000);
    });

    /* ===== PAGE VISIBILITY HANDLING ===== */
    let refreshInterval;

    const handleVisibilityChange = () => {
      if (document.hidden) {
        // Page is hidden, clear intervals
        if (refreshInterval) {
          clearInterval(refreshInterval);
          refreshInterval = null;
        }
      } else {
        // Page is visible, resume operations
        console.log('Page became visible, refreshing data...');
        
        // Refresh data every 10 minutes when page is active
        refreshInterval = setInterval(() => {
          console.log('Auto-refresh triggered');
          animateCounters();
        }, 600000); // 10 minutes
      }
    };

    document.addEventListener('visibilitychange', handleVisibilityChange);

    /* ===== INITIALIZATION ===== */
    document.addEventListener('DOMContentLoaded', async () => {
      console.log(`🌌 Servizi MyApp v${APP_CONFIG.version} - Aurora Boreale 2025 Ultra-Leggibile`);
      
      showLoading('Inizializzazione Aurora Boreale 2025...');
      
      try {
        // Initialize components
        initTabs();
        
        // Simulate loading time for smooth UX
        await new Promise(resolve => setTimeout(resolve, 600));
        
        // Animate counters
        setTimeout(animateCounters, 500);
        
        // Start page visibility handling
        handleVisibilityChange();
        
        hideLoading();
        showNote('🌌 Aurora Boreale 2025 attiva! Servizi ultra-leggibili caricati.', 'success');
        
        // Focus management for accessibility
        const firstTab = document.querySelector('.ultra-tab');
        if (firstTab && document.activeElement === document.body) {
          firstTab.focus();
        }
        
      } catch (error) {
        console.error('Initialization error:', error);
        hideLoading();
        showNote('⚠️ Caricamento completato con alcuni avvisi. Funzionalità disponibili.', 'warning');
      }
    });

    /* ===== PERFORMANCE MONITORING ===== */
    window.addEventListener('load', () => {
      if ('performance' in window) {
        const loadTime = performance.now();
        console.log(`📊 Page loaded in ${Math.round(loadTime)}ms`);
        
        if (loadTime > 3000) {
          console.warn('⚠️ Slow page load detected');
        }
      }
    });

    /* ===== ERROR HANDLING ===== */
    window.addEventListener('error', (e) => {
      console.error('Global error:', e.error);
      showNote('⚠️ Si è verificato un errore. La pagina continua a funzionare.', 'warning');
    });

    window.addEventListener('unhandledrejection', (e) => {
      console.error('Unhandled promise rejection:', e.reason);
      e.preventDefault(); // Prevent console error
    });
  </script>
</body>
</html>