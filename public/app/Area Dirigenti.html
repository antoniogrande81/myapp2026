<!DOCTYPE html><html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Area Dirigenti - MyApp</title>  <script src="https://cdn.tailwindcss.com"></script>  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2400C1',
            secondary: '#8E008C',
            accent: '#00BFFF'
          }
        }
      }
    }
  </script>  <style>
    .form-input {
      @apply w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500;
    }
    .btn-primary {
      @apply bg-primary text-white px-4 py-2 rounded hover:bg-blue-800 transition;
    }
    .success-message {
      @apply bg-green-100 border border-green-400 text-green-700 px-4 py-2 rounded mb-4;
    }
    .error-message {
      @apply bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mb-4;
    }
  </style></head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-3xl mx-auto p-4">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold">Area Dirigenti</h1>
      <button id="logoutBtn" class="text-red-600 hover:underline">Logout</button>
    </div><section class="mb-10">
  <h2 class="text-xl font-bold mb-4">üì¢ Notizie</h2>
  <form id="notizieForm" class="bg-white p-4 rounded shadow space-y-3 mb-6">
    <input type="text" id="titoloNotizia" placeholder="Titolo" required class="form-input" />
    <textarea id="contenutoNotizia" placeholder="Contenuto" rows="3" required class="form-input"></textarea>
    <div class="grid grid-cols-2 gap-3">
      <select id="prioritaNotizia" class="form-input">
        <option value="normale">Normale</option>
        <option value="alta">Alta</option>
        <option value="urgente">Urgente</option>
      </select>
      <input type="text" id="iconaNotizia" class="form-input" value="üì¢" placeholder="Emoji/Icona" />
    </div>
    <button type="submit" class="btn-primary w-full">Pubblica Notizia</button>
  </form>
  <div id="listaNotizie" class="space-y-3 text-sm">
    <p class="text-center text-gray-500">Caricamento notizie...</p>
  </div>
</section>

<section class="mb-10">
  <h2 class="text-xl font-bold mb-4">üåÇ Convenzioni</h2>
  <form id="convenzioniForm" class="bg-white p-4 rounded shadow space-y-3 mb-6">
    <input type="text" id="nomePartner" placeholder="Nome Partner" required class="form-input" />
    <textarea id="descrizioneConvenzione" placeholder="Descrizione" rows="3" required class="form-input"></textarea>
    <input type="text" id="categoriaConvenzione" placeholder="Categoria" required class="form-input" />
    <button type="submit" class="btn-primary w-full">Aggiungi Convenzione</button>
  </form>
  <div id="listaConvenzioni" class="space-y-3 text-sm">
    <p class="text-center text-gray-500">Caricamento convenzioni...</p>
  </div>
</section>

  </div>  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    const supabase = createClient('https://lycrgzptkdkksukcwrld.supabase.co', 'INSERISCI_LA_TUA_CHIAVE_PUBLICA');

    let userData = null;

    async function verificaAutenticazione() {
      const { data: { user }, error } = await supabase.auth.getUser();
      if (error || !user) return location.href = '../login.html';

      const { data: profilo, error: profErr } = await supabase.from('profiles').select('*').eq('id', user.id).single();
      if (profErr) return location.href = '../login.html';

      const ruoli = profilo.ruoli || [];
      if (!ruoli.includes('DIRIGENTE') && !ruoli.includes('ADMIN')) return location.href = '../login.html';

      userData = { ...user, ...profilo };
    }

    function showMessage(msg, type = 'success') {
      const div = document.createElement('div');
      div.className = type === 'success' ? 'success-message' : 'error-message';
      div.textContent = msg;
      document.body.prepend(div);
      setTimeout(() => div.remove(), 5000);
    }

    async function pubblicaNotizia(e) {
      e.preventDefault();
      const titolo = document.getElementById('titoloNotizia').value;
      const contenuto = document.getElementById('contenutoNotizia').value;
      const priorita = document.getElementById('prioritaNotizia').value;
      const icona = document.getElementById('iconaNotizia').value || 'üì¢';

      const { error } = await supabase.from('notizie').insert([{
        titolo, contenuto, priorita, icona,
        data_pubblicazione: new Date().toISOString(),
        pubblicata: true, autore_id: userData.id
      }]);
      if (error) return showMessage("Errore pubblicazione", 'error');

      e.target.reset();
      document.getElementById('iconaNotizia').value = 'üì¢';
      showMessage("Notizia pubblicata!");
      await caricaNotizie();
    }

    async function caricaNotizie() {
      const { data, error } = await supabase.from('notizie').select('*').order('data_pubblicazione', { ascending: false });
      const container = document.getElementById('listaNotizie');
      if (error || !data) return container.innerHTML = '<p class="text-center text-gray-500">Errore caricamento.</p>';

      container.innerHTML = data.map(n => {
        const dataPub = new Date(n.data_pubblicazione).toLocaleDateString('it-IT');
        const isAutore = userData.id === n.autore_id;
        return `
          <div class="bg-white p-3 rounded shadow flex justify-between items-start">
            <div>
              <div class="flex items-center gap-2 mb-1">
                <span>${n.icona}</span>
                <strong>${n.titolo}</strong>
              </div>
              <p>${n.contenuto}</p>
              <p class="text-xs text-blue-600 mt-1">${dataPub} ‚Äì ${n.priorita}</p>
            </div>
            ${isAutore ? `<button onclick="eliminaNotizia('${n.id}')" class="text-red-500">üóëÔ∏è</button>` : ''}
          </div>`;
      }).join('');
    }

    async function eliminaNotizia(id) {
      if (!confirm('Eliminare questa notizia?')) return;
      const { error } = await supabase.from('notizie').delete().eq('id', id).eq('autore_id', userData.id);
      if (error) return showMessage('Errore eliminazione', 'error');
      showMessage('Notizia eliminata');
      await caricaNotizie();
    }
    window.eliminaNotizia = eliminaNotizia;

    async function aggiungiConvenzione(e) {
      e.preventDefault();
      const nome = document.getElementById('nomePartner').value;
      const descrizione = document.getElementById('descrizioneConvenzione').value;
      const categoria = document.getElementById('categoriaConvenzione').value;

      const { error } = await supabase.from('convenzioni').insert([{
        nome_partner: nome,
        descrizione,
        categoria,
        data_creazione: new Date().toISOString(),
        autore_id: userData.id
      }]);
      if (error) return showMessage('Errore inserimento convenzione', 'error');

      e.target.reset();
      showMessage('Convenzione aggiunta!');
      await caricaConvenzioni();
    }

    async function caricaConvenzioni() {
      const { data, error } = await supabase.from('convenzioni').select('*').order('data_creazione', { ascending: false });
      const container = document.getElementById('listaConvenzioni');
      if (error || !data) return container.innerHTML = '<p class="text-center text-gray-500">Errore caricamento.</p>';

      container.innerHTML = data.map(c => {
        const dataC = new Date(c.data_creazione).toLocaleDateString('it-IT');
        const isAutore = userData.id === c.autore_id;
        return `
          <div class="bg-white p-3 rounded shadow flex justify-between items-start">
            <div>
              <strong>${c.nome_partner}</strong>
              <p>${c.descrizione}</p>
              <p class="text-xs text-blue-600 mt-1">${c.categoria} ‚Äì ${dataC}</p>
            </div>
            ${isAutore ? `<button onclick="eliminaConvenzione('${c.id}')" class="text-red-500">üóëÔ∏è</button>` : ''}
          </div>`;
      }).join('');
    }

    async function eliminaConvenzione(id) {
      if (!confirm('Eliminare questa convenzione?')) return;
      const { error } = await supabase.from('convenzioni').delete().eq('id', id).eq('autore_id', userData.id);
      if (error) return showMessage('Errore eliminazione', 'error');
      showMessage('Convenzione eliminata');
      await caricaConvenzioni();
    }
    window.eliminaConvenzione = eliminaConvenzione;

    document.addEventListener('DOMContentLoaded', async () => {
      await verificaAutenticazione();
      document.getElementById('notizieForm').addEventListener('submit', pubblicaNotizia);
      document.getElementById('convenzioniForm').addEventListener('submit', aggiungiConvenzione);
      document.getElementById('logoutBtn').addEventListener('click', async () => {
        await supabase.auth.signOut();
        location.href = '../login.html';
      });
      await caricaNotizie();
      await caricaConvenzioni();
    });
  </script></body>
</html><!DOCTYPE html><html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Area Dirigenti - MyApp</title>  <script src="https://cdn.tailwindcss.com"></script>  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2400C1',
            secondary: '#8E008C',
            accent: '#00BFFF'
          }
        }
      }
    }
  </script>  <style>
    .form-input {
      @apply w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500;
    }
    .btn-primary {
      @apply bg-primary text-white px-4 py-2 rounded hover:bg-blue-800 transition;
    }
    .success-message {
      @apply bg-green-100 border border-green-400 text-green-700 px-4 py-2 rounded mb-4;
    }
    .error-message {
      @apply bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mb-4;
    }
  </style></head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-3xl mx-auto p-4">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold">Area Dirigenti</h1>
      <button id="logoutBtn" class="text-red-600 hover:underline">Logout</button>
    </div><section class="mb-10">
  <h2 class="text-xl font-bold mb-4">üì¢ Notizie</h2>
  <form id="notizieForm" class="bg-white p-4 rounded shadow space-y-3 mb-6">
    <input type="text" id="titoloNotizia" placeholder="Titolo" required class="form-input" />
    <textarea id="contenutoNotizia" placeholder="Contenuto" rows="3" required class="form-input"></textarea>
    <div class="grid grid-cols-2 gap-3">
      <select id="prioritaNotizia" class="form-input">
        <option value="normale">Normale</option>
        <option value="alta">Alta</option>
        <option value="urgente">Urgente</option>
      </select>
      <input type="text" id="iconaNotizia" class="form-input" value="üì¢" placeholder="Emoji/Icona" />
    </div>
    <button type="submit" class="btn-primary w-full">Pubblica Notizia</button>
  </form>
  <div id="listaNotizie" class="space-y-3 text-sm">
    <p class="text-center text-gray-500">Caricamento notizie...</p>
  </div>
</section>

<section class="mb-10">
  <h2 class="text-xl font-bold mb-4">üåÇ Convenzioni</h2>
  <form id="convenzioniForm" class="bg-white p-4 rounded shadow space-y-3 mb-6">
    <input type="text" id="nomePartner" placeholder="Nome Partner" required class="form-input" />
    <textarea id="descrizioneConvenzione" placeholder="Descrizione" rows="3" required class="form-input"></textarea>
    <input type="text" id="categoriaConvenzione" placeholder="Categoria" required class="form-input" />
    <button type="submit" class="btn-primary w-full">Aggiungi Convenzione</button>
  </form>
  <div id="listaConvenzioni" class="space-y-3 text-sm">
    <p class="text-center text-gray-500">Caricamento convenzioni...</p>
  </div>
</section>

  </div>  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    const supabase = createClient('https://lycrgzptkdkksukcwrld.supabase.co', 'INSERISCI_LA_TUA_CHIAVE_PUBLICA');

    let userData = null;

    async function verificaAutenticazione() {
      const { data: { user }, error } = await supabase.auth.getUser();
      if (error || !user) return location.href = '../login.html';

      const { data: profilo, error: profErr } = await supabase.from('profiles').select('*').eq('id', user.id).single();
      if (profErr) return location.href = '../login.html';

      const ruoli = profilo.ruoli || [];
      if (!ruoli.includes('DIRIGENTE') && !ruoli.includes('ADMIN')) return location.href = '../login.html';

      userData = { ...user, ...profilo };
    }

    function showMessage(msg, type = 'success') {
      const div = document.createElement('div');
      div.className = type === 'success' ? 'success-message' : 'error-message';
      div.textContent = msg;
      document.body.prepend(div);
      setTimeout(() => div.remove(), 5000);
    }

    async function pubblicaNotizia(e) {
      e.preventDefault();
      const titolo = document.getElementById('titoloNotizia').value;
      const contenuto = document.getElementById('contenutoNotizia').value;
      const priorita = document.getElementById('prioritaNotizia').value;
      const icona = document.getElementById('iconaNotizia').value || 'üì¢';

      const { error } = await supabase.from('notizie').insert([{
        titolo, contenuto, priorita, icona,
        data_pubblicazione: new Date().toISOString(),
        pubblicata: true, autore_id: userData.id
      }]);
      if (error) return showMessage("Errore pubblicazione", 'error');

      e.target.reset();
      document.getElementById('iconaNotizia').value = 'üì¢';
      showMessage("Notizia pubblicata!");
      await caricaNotizie();
    }

    async function caricaNotizie() {
      const { data, error } = await supabase.from('notizie').select('*').order('data_pubblicazione', { ascending: false });
      const container = document.getElementById('listaNotizie');
      if (error || !data) return container.innerHTML = '<p class="text-center text-gray-500">Errore caricamento.</p>';

      container.innerHTML = data.map(n => {
        const dataPub = new Date(n.data_pubblicazione).toLocaleDateString('it-IT');
        const isAutore = userData.id === n.autore_id;
        return `
          <div class="bg-white p-3 rounded shadow flex justify-between items-start">
            <div>
              <div class="flex items-center gap-2 mb-1">
                <span>${n.icona}</span>
                <strong>${n.titolo}</strong>
              </div>
              <p>${n.contenuto}</p>
              <p class="text-xs text-blue-600 mt-1">${dataPub} ‚Äì ${n.priorita}</p>
            </div>
            ${isAutore ? `<button onclick="eliminaNotizia('${n.id}')" class="text-red-500">üóëÔ∏è</button>` : ''}
          </div>`;
      }).join('');
    }

    async function eliminaNotizia(id) {
      if (!confirm('Eliminare questa notizia?')) return;
      const { error } = await supabase.from('notizie').delete().eq('id', id).eq('autore_id', userData.id);
      if (error) return showMessage('Errore eliminazione', 'error');
      showMessage('Notizia eliminata');
      await caricaNotizie();
    }
    window.eliminaNotizia = eliminaNotizia;

    async function aggiungiConvenzione(e) {
      e.preventDefault();
      const nome = document.getElementById('nomePartner').value;
      const descrizione = document.getElementById('descrizioneConvenzione').value;
      const categoria = document.getElementById('categoriaConvenzione').value;

      const { error } = await supabase.from('convenzioni').insert([{
        nome_partner: nome,
        descrizione,
        categoria,
        data_creazione: new Date().toISOString(),
        autore_id: userData.id
      }]);
      if (error) return showMessage('Errore inserimento convenzione', 'error');

      e.target.reset();
      showMessage('Convenzione aggiunta!');
      await caricaConvenzioni();
    }

    async function caricaConvenzioni() {
      const { data, error } = await supabase.from('convenzioni').select('*').order('data_creazione', { ascending: false });
      const container = document.getElementById('listaConvenzioni');
      if (error || !data) return container.innerHTML = '<p class="text-center text-gray-500">Errore caricamento.</p>';

      container.innerHTML = data.map(c => {
        const dataC = new Date(c.data_creazione).toLocaleDateString('it-IT');
        const isAutore = userData.id === c.autore_id;
        return `
          <div class="bg-white p-3 rounded shadow flex justify-between items-start">
            <div>
              <strong>${c.nome_partner}</strong>
              <p>${c.descrizione}</p>
              <p class="text-xs text-blue-600 mt-1">${c.categoria} ‚Äì ${dataC}</p>
            </div>
            ${isAutore ? `<button onclick="eliminaConvenzione('${c.id}')" class="text-red-500">üóëÔ∏è</button>` : ''}
          </div>`;
      }).join('');
    }

    async function eliminaConvenzione(id) {
      if (!confirm('Eliminare questa convenzione?')) return;
      const { error } = await supabase.from('convenzioni').delete().eq('id', id).eq('autore_id', userData.id);
      if (error) return showMessage('Errore eliminazione', 'error');
      showMessage('Convenzione eliminata');
      await caricaConvenzioni();
    }
    window.eliminaConvenzione = eliminaConvenzione;

    document.addEventListener('DOMContentLoaded', async () => {
      await verificaAutenticazione();
      document.getElementById('notizieForm').addEventListener('submit', pubblicaNotizia);
      document.getElementById('convenzioniForm').addEventListener('submit', aggiungiConvenzione);
      document.getElementById('logoutBtn').addEventListener('click', async () => {
        await supabase.auth.signOut();
        location.href = '../login.html';
      });
      await caricaNotizie();
      await caricaConvenzioni();
    });
  </script></body>
</html><!DOCTYPE html><html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Area Dirigenti - MyApp</title>  <script src="https://cdn.tailwindcss.com"></script>  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2400C1',
            secondary: '#8E008C',
            accent: '#00BFFF'
          }
        }
      }
    }
  </script>  <style>
    .form-input {
      @apply w-full px-4 py-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500;
    }
    .btn-primary {
      @apply bg-primary text-white px-4 py-2 rounded hover:bg-blue-800 transition;
    }
    .success-message {
      @apply bg-green-100 border border-green-400 text-green-700 px-4 py-2 rounded mb-4;
    }
    .error-message {
      @apply bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mb-4;
    }
  </style></head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-3xl mx-auto p-4">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold">Area Dirigenti</h1>
      <button id="logoutBtn" class="text-red-600 hover:underline">Logout</button>
    </div><section class="mb-10">
  <h2 class="text-xl font-bold mb-4">üì¢ Notizie</h2>
  <form id="notizieForm" class="bg-white p-4 rounded shadow space-y-3 mb-6">
    <input type="text" id="titoloNotizia" placeholder="Titolo" required class="form-input" />
    <textarea id="contenutoNotizia" placeholder="Contenuto" rows="3" required class="form-input"></textarea>
    <div class="grid grid-cols-2 gap-3">
      <select id="prioritaNotizia" class="form-input">
        <option value="normale">Normale</option>
        <option value="alta">Alta</option>
        <option value="urgente">Urgente</option>
      </select>
      <input type="text" id="iconaNotizia" class="form-input" value="üì¢" placeholder="Emoji/Icona" />
    </div>
    <button type="submit" class="btn-primary w-full">Pubblica Notizia</button>
  </form>
  <div id="listaNotizie" class="space-y-3 text-sm">
    <p class="text-center text-gray-500">Caricamento notizie...</p>
  </div>
</section>

<section class="mb-10">
  <h2 class="text-xl font-bold mb-4">üåÇ Convenzioni</h2>
  <form id="convenzioniForm" class="bg-white p-4 rounded shadow space-y-3 mb-6">
    <input type="text" id="nomePartner" placeholder="Nome Partner" required class="form-input" />
    <textarea id="descrizioneConvenzione" placeholder="Descrizione" rows="3" required class="form-input"></textarea>
    <input type="text" id="categoriaConvenzione" placeholder="Categoria" required class="form-input" />
    <button type="submit" class="btn-primary w-full">Aggiungi Convenzione</button>
  </form>
  <div id="listaConvenzioni" class="space-y-3 text-sm">
    <p class="text-center text-gray-500">Caricamento convenzioni...</p>
  </div>
</section>

  </div>  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    const supabase = createClient('https://lycrgzptkdkksukcwrld.supabase.co', 'INSERISCI_LA_TUA_CHIAVE_PUBLICA');

    let userData = null;

    async function verificaAutenticazione() {
      const { data: { user }, error } = await supabase.auth.getUser();
      if (error || !user) return location.href = '../login.html';

      const { data: profilo, error: profErr } = await supabase.from('profiles').select('*').eq('id', user.id).single();
      if (profErr) return location.href = '../login.html';

      const ruoli = profilo.ruoli || [];
      if (!ruoli.includes('DIRIGENTE') && !ruoli.includes('ADMIN')) return location.href = '../login.html';

      userData = { ...user, ...profilo };
    }

    function showMessage(msg, type = 'success') {
      const div = document.createElement('div');
      div.className = type === 'success' ? 'success-message' : 'error-message';
      div.textContent = msg;
      document.body.prepend(div);
      setTimeout(() => div.remove(), 5000);
    }

    async function pubblicaNotizia(e) {
      e.preventDefault();
      const titolo = document.getElementById('titoloNotizia').value;
      const contenuto = document.getElementById('contenutoNotizia').value;
      const priorita = document.getElementById('prioritaNotizia').value;
      const icona = document.getElementById('iconaNotizia').value || 'üì¢';

      const { error } = await supabase.from('notizie').insert([{
        titolo, contenuto, priorita, icona,
        data_pubblicazione: new Date().toISOString(),
        pubblicata: true, autore_id: userData.id
      }]);
      if (error) return showMessage("Errore pubblicazione", 'error');

      e.target.reset();
      document.getElementById('iconaNotizia').value = 'üì¢';
      showMessage("Notizia pubblicata!");
      await caricaNotizie();
    }

    async function caricaNotizie() {
      const { data, error } = await supabase.from('notizie').select('*').order('data_pubblicazione', { ascending: false });
      const container = document.getElementById('listaNotizie');
      if (error || !data) return container.innerHTML = '<p class="text-center text-gray-500">Errore caricamento.</p>';

      container.innerHTML = data.map(n => {
        const dataPub = new Date(n.data_pubblicazione).toLocaleDateString('it-IT');
        const isAutore = userData.id === n.autore_id;
        return `
          <div class="bg-white p-3 rounded shadow flex justify-between items-start">
            <div>
              <div class="flex items-center gap-2 mb-1">
                <span>${n.icona}</span>
                <strong>${n.titolo}</strong>
              </div>
              <p>${n.contenuto}</p>
              <p class="text-xs text-blue-600 mt-1">${dataPub} ‚Äì ${n.priorita}</p>
            </div>
            ${isAutore ? `<button onclick="eliminaNotizia('${n.id}')" class="text-red-500">üóëÔ∏è</button>` : ''}
          </div>`;
      }).join('');
    }

    async function eliminaNotizia(id) {
      if (!confirm('Eliminare questa notizia?')) return;
      const { error } = await supabase.from('notizie').delete().eq('id', id).eq('autore_id', userData.id);
      if (error) return showMessage('Errore eliminazione', 'error');
      showMessage('Notizia eliminata');
      await caricaNotizie();
    }
    window.eliminaNotizia = eliminaNotizia;

    async function aggiungiConvenzione(e) {
      e.preventDefault();
      const nome = document.getElementById('nomePartner').value;
      const descrizione = document.getElementById('descrizioneConvenzione').value;
      const categoria = document.getElementById('categoriaConvenzione').value;

      const { error } = await supabase.from('convenzioni').insert([{
        nome_partner: nome,
        descrizione,
        categoria,
        data_creazione: new Date().toISOString(),
        autore_id: userData.id
      }]);
      if (error) return showMessage('Errore inserimento convenzione', 'error');

      e.target.reset();
      showMessage('Convenzione aggiunta!');
      await caricaConvenzioni();
    }

    async function caricaConvenzioni() {
      const { data, error } = await supabase.from('convenzioni').select('*').order('data_creazione', { ascending: false });
      const container = document.getElementById('listaConvenzioni');
      if (error || !data) return container.innerHTML = '<p class="text-center text-gray-500">Errore caricamento.</p>';

      container.innerHTML = data.map(c => {
        const dataC = new Date(c.data_creazione).toLocaleDateString('it-IT');
        const isAutore = userData.id === c.autore_id;
        return `
          <div class="bg-white p-3 rounded shadow flex justify-between items-start">
            <div>
              <strong>${c.nome_partner}</strong>
              <p>${c.descrizione}</p>
              <p class="text-xs text-blue-600 mt-1">${c.categoria} ‚Äì ${dataC}</p>
            </div>
            ${isAutore ? `<button onclick="eliminaConvenzione('${c.id}')" class="text-red-500">üóëÔ∏è</button>` : ''}
          </div>`;
      }).join('');
    }

    async function eliminaConvenzione(id) {
      if (!confirm('Eliminare questa convenzione?')) return;
      const { error } = await supabase.from('convenzioni').delete().eq('id', id).eq('autore_id', userData.id);
      if (error) return showMessage('Errore eliminazione', 'error');
      showMessage('Convenzione eliminata');
      await caricaConvenzioni();
    }
    window.eliminaConvenzione = eliminaConvenzione;

    document.addEventListener('DOMContentLoaded', async () => {
      await verificaAutenticazione();
      document.getElementById('notizieForm').addEventListener('submit', pubblicaNotizia);
      document.getElementById('convenzioniForm').addEventListener('submit', aggiungiConvenzione);
      document.getElementById('logoutBtn').addEventListener('click', async () => {
        await supabase.auth.signOut();
        location.href = '../login.html';
      });
      await caricaNotizie();
      await caricaConvenzioni();
    });
  </script></body>
</html>
